(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6134],{65141:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/news",function(){return r(19372)}])},19372:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var n=r(34051),i=r.n(n),a=r(85893),s=r(67294),o=r(2734),c=r(98396),u=r(87357),l=r(15861),f=r(88082),p=r(11057),d=r(10633),x=r(50657),v=r(37645),h=r(93946),m=r(6514),w=r(31425),b=r(50594),y=r(98993),g=r(89328),k=r(36100);function j(e,t,r,n,i,a,s){try{var o=e[a](s),c=o.value}catch(u){return void r(u)}o.done?t(c):Promise.resolve(c).then(n,i)}function S(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){j(a,n,i,s,o,"next",e)}function o(e){j(a,n,i,s,o,"throw",e)}s(void 0)}))}}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){O(e,t,r[t])}))}return e}function N(){var e=(0,s.useState)([]),t=e[0],r=e[1],n=(0,s.useState)(1),j=n[0],N=n[1],_=(0,s.useState)(!1),P=_[0],C=_[1],D=(0,s.useState)(null),E=D[0],W=D[1],I=(0,s.useState)({}),J=I[0],A=I[1],B=(0,s.useState)(new Set),T=B[0],L=B[1],U=(0,o.Z)(),M=(0,c.Z)(U.breakpoints.down("sm")),Q=function(e){if(!e)return 0;if("function"===typeof e.toDate)return e.toDate().getTime();if(null===e||void 0===e?void 0:e.seconds)return 1e3*Number(e.seconds);if("number"===typeof e)return e;var t=Number(e);if(!Number.isNaN(t)&&t>0)return t;var r=Date.parse(String(e));return Number.isNaN(r)?0:r},R=function(e){var t=Q(e);if(!t)return"";try{return new Date(t).toLocaleString()}catch(r){return""}};(0,s.useEffect)((function(){try{var e=window.localStorage.getItem("news_read_ids")||"{}",t=JSON.parse(e||"{}"),n=new Set(Object.keys(t));L(n)}catch(o){L(new Set)}var a=!0;function s(){return(s=S(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.lh)();case 2:if(t=e.sent,a){e.next=5;break}return e.abrupt("return");case 5:return(n=(t||[]).map((function(e){return Z({},e)}))).sort((function(e,t){return Q(t.created)-Q(e.created)})),r(n),e.next=10,q(n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){s.apply(this,arguments)}(),function(){a=!1}}),[]),(0,s.useEffect)((function(){try{var e=Math.max(1,Math.ceil((t||[]).length/5));j>e&&N(e)}catch(r){}}),[t,j]);var X=function(e,t){return(null===e||void 0===e?void 0:e.id)||(null===e||void 0===e?void 0:e.newsId)||String(t)},z=/(https?:\/\/[^\s]+)/g,F=function(e){if(!e)return null;for(var t,r=[],n=0;null!==(t=z.exec(e));){var i=t.index,s=t[0];i>n&&r.push({type:"text",text:e.slice(n,i)}),r.push({type:"url",text:s}),n=i+s.length}return n<e.length&&r.push({type:"text",text:e.slice(n)}),r.map((function(e,t){return"url"===e.type?(0,a.jsx)("a",{href:e.text,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2",textDecoration:"underline"},children:e.text},t):(0,a.jsx)("span",{children:e.text},t)}))},H=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600;if(!e)return"";var r=e.replace(/\s+/g," ").trim();return r.length>t?r.slice(0,t).trim()+"...":r},V=function(e){if(!e)return[];var t,r,n,i=null!==(n=null!==(r=null!==(t=e.imageUrl)&&void 0!==t?t:e.images)&&void 0!==r?r:e.imagesList)&&void 0!==n?n:"";if(!i)return[];if(Array.isArray(i))return i.filter(Boolean);if("string"===typeof i){try{var a=JSON.parse(i);if(Array.isArray(a))return a.filter(Boolean)}catch(s){}return i.split(",").map((function(e){return e.trim()})).filter(Boolean)}return[]},q=function(){var e=S(i().mark((function e(){var t,r,n=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:[],r={},e.next=4,Promise.all((t||[]).map(function(){var e=S(i().mark((function e(t,n){var a,s,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=X(t,n),e.prev=1,s=(0,k.JU)(g.db,"news",a),e.next=5,(0,k.QT)(s);case 5:if(!(o=e.sent).exists()){e.next=17;break}if("number"===typeof(c=o.data()).views){e.next=14;break}return e.next=11,(0,k.pl)(s,{views:0},{merge:!0});case 11:r[a]=0,e.next=15;break;case 14:r[a]=c.views;case 15:e.next=20;break;case 17:return e.next=19,(0,k.pl)(s,{views:0},{merge:!0});case 19:r[a]=0;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),r[a]=0;case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,r){return e.apply(this,arguments)}}()));case 4:A(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=S(i().mark((function e(t,r){var n,a,s,o,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=X(t,r),a=(0,k.JU)(g.db,"news",n),e.prev=2,e.next=5,(0,k.i3)(g.db,function(){var e=S(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get(a);case 2:(r=e.sent).exists()?"number"!==typeof r.data().views?t.update(a,{views:1}):t.update(a,{views:(0,k.nP)(1)}):t.set(a,{views:1},{merge:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return e.prev=5,e.next=8,(0,k.QT)(a);case 8:return s=e.sent,o=s.exists()&&"number"===typeof s.data().views?s.data().views:0,A((function(e){return Z({},e,O({},n,o))})),e.abrupt("return",o);case 14:return e.prev=14,e.t0=e.catch(5),A((function(e){return Z({},e,O({},n,(e[n]||0)+1))})),e.abrupt("return",(J[n]||0)+1);case 18:e.next=39;break;case 20:return e.prev=20,e.t1=e.catch(2),console.error("incrementNewsView failed",e.t1),e.prev=23,e.next=26,(0,k.QT)(a);case 26:return c=e.sent,u=c.exists()&&"number"===typeof c.data().views?c.data().views+1:1,e.next=30,(0,k.pl)(a,{views:u},{merge:!0});case 30:return A((function(e){return Z({},e,O({},n,u))})),e.abrupt("return",u);case 34:return e.prev=34,e.t2=e.catch(23),console.error("incrementNewsView fallback failed",e.t2),e.abrupt("return",null!==(l=J[n])&&void 0!==l?l:0);case 39:case"end":return e.stop()}}),e,null,[[2,20],[5,14],[23,34]])})));return function(t,r){return e.apply(this,arguments)}}(),G=function(){var e=S(i().mark((function e(t,r){var n,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(t),C(!0),e.prev=2,e.next=5,Y(t,r);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("handleOpen increment failed",e.t0);case 10:try{n=X(t,r),a=window.localStorage.getItem("news_read_ids")||"{}",(s=JSON.parse(a||"{}"))[n]=Date.now(),window.localStorage.setItem("news_read_ids",JSON.stringify(s)),L(new Set(Object.keys(s)))}catch(i){}case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,r){return e.apply(this,arguments)}}(),K=function(){C(!1),W(null)};return(0,a.jsxs)(u.Z,{sx:{maxWidth:1100,mx:"auto",mt:4,px:{xs:2,sm:3}},children:[(0,a.jsx)(l.Z,{variant:"h4",gutterBottom:!0,children:"News"}),0===t.length&&(0,a.jsx)(l.Z,{children:"Loading..."}),function(){var e=5*(j-1);return(t||[]).slice(e,e+5).map((function(t,r){var n=V(t),i=e+r,s=X(t,i),o=!T.has(String(s));return(0,a.jsxs)(u.Z,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:"flex-start",mb:3,p:2,borderRadius:2,bgcolor:o?"rgba(255,249,196,0.08)":"background.paper",boxShadow:1,cursor:"pointer"},onClick:function(){return G(t,i)},children:[n.length>0&&(0,a.jsx)(u.Z,{component:"img",src:String(n[0]),alt:"thumb",onError:function(e){var t;console.error("news thumb failed to load:",null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.src),e.target.style.display="none"},sx:{width:{xs:"100%",sm:360},height:{xs:180,sm:220},objectFit:"cover",borderRadius:1,border:"1px solid #eee",flexShrink:0}}),(0,a.jsxs)(u.Z,{sx:{flex:1,minWidth:0},children:[function(){var e=T.has(String(s));return(0,a.jsx)(f.Z,{color:"error",variant:"dot",invisible:e,sx:{mr:1},children:(0,a.jsx)(l.Z,{variant:"h6",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:{xs:"normal",sm:"nowrap"},fontWeight:e?700:400},children:t.title})})}(),(0,a.jsx)(u.Z,{sx:{display:"flex",gap:2,alignItems:"center",mb:1,flexWrap:"wrap"},children:(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:R(t.created)})}),(0,a.jsx)(l.Z,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:{xs:5,sm:6},WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:1},children:F(H(t.content))}),(0,a.jsx)(p.Z,{size:"small",onClick:function(e){e.stopPropagation(),G(t,r)},children:"See more"})]})]},s)}))}(),t.length>5&&(0,a.jsx)(u.Z,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,a.jsx)(d.Z,{count:Math.ceil(t.length/5),page:j,onChange:function(e,t){return N(t)},color:"primary"})}),(0,a.jsxs)(x.Z,{open:P,onClose:K,fullWidth:!0,maxWidth:"md",fullScreen:M,children:[(0,a.jsxs)(v.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",py:{xs:1,sm:2}},children:[(0,a.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,a.jsx)("span",{style:{wordBreak:"break-word",fontWeight:600},children:null===E||void 0===E?void 0:E.title}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:R(null===E||void 0===E?void 0:E.created)})]}),(0,a.jsx)(h.Z,{onClick:K,size:"small",children:(0,a.jsx)(b.Z,{})})]}),(0,a.jsxs)(m.Z,{dividers:!0,sx:{p:{xs:2,sm:3}},children:[(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:R(null===E||void 0===E?void 0:E.created)}),(0,a.jsx)(l.Z,{component:"div",sx:{whiteSpace:"pre-line",mb:2},children:F(null===E||void 0===E?void 0:E.content)}),E&&V(E).length>0&&(0,a.jsx)(u.Z,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2,maxHeight:{xs:"80vh",sm:"80vh"},overflowY:"auto",pr:1},children:V(E).map((function(e,t){return(0,a.jsx)(u.Z,{component:"img",src:String(e),alt:"news-".concat(t),onError:function(e){e.target.style.display="none"},sx:{width:"100%",borderRadius:1}},t)}))})]}),(0,a.jsx)(w.Z,{sx:{p:{xs:1,sm:2}},children:(0,a.jsx)(p.Z,{onClick:K,children:"Close"})})]})]})}},98993:function(e,t,r){"use strict";r.d(t,{lh:function(){return x},kN:function(){return h}});var n=r(34051),i=r.n(n),a=r(89328),s=r(36100),o=r(86650);function c(e,t,r,n,i,a,s){try{var o=e[a](s),c=o.value}catch(u){return void r(u)}o.done?t(c):Promise.resolve(c).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){c(a,n,i,s,o,"next",e)}function o(e){c(a,n,i,s,o,"throw",e)}s(void 0)}))}}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){l(e,t,r[t])}))}return e}var p="news",d=(0,o.cF)();function x(){return v.apply(this,arguments)}function v(){return(v=u(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,s.IO)((0,s.hJ)(a.db,p),(0,s.Xo)("created","desc")),e.next=3,(0,s.PL)(t);case 3:return r=e.sent,e.abrupt("return",r.docs.map((function(e){return f({id:e.id},e.data())})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return m.apply(this,arguments)}function m(){return(m=u(i().mark((function e(t,r){var n,c,u,l,f,x,v,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!r){e.next=38;break}n=Array.isArray(r)?r:"string"===typeof r?[r]:(null===r||void 0===r?void 0:r.url)?[r.url]:[],c=!0,u=!1,l=void 0,e.prev=4,f=n[Symbol.iterator]();case 6:if(c=(x=f.next()).done){e.next=24;break}if(v=x.value){e.next=10;break}return e.abrupt("continue",21);case 10:if("string"!==typeof v||!v.startsWith("http://")&&!v.startsWith("https://")){e.next=12;break}return e.abrupt("continue",21);case 12:return e.prev=12,h=(0,o.iH)(d,v),e.next=16,(0,o.oq)(h);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),console.warn("deleteNews: failed to delete storage object",v,(null===e.t0||void 0===e.t0?void 0:e.t0.message)||e.t0);case 21:c=!0,e.next=6;break;case 24:e.next=30;break;case 26:e.prev=26,e.t1=e.catch(4),u=!0,l=e.t1;case 30:e.prev=30,e.prev=31,c||null==f.return||f.return();case 33:if(e.prev=33,!u){e.next=36;break}throw l;case 36:return e.finish(33);case 37:return e.finish(30);case 38:e.next=43;break;case 40:e.prev=40,e.t2=e.catch(0),console.warn("deleteNews: unexpected error while deleting images",(null===e.t2||void 0===e.t2?void 0:e.t2.message)||e.t2);case 43:if(!t){e.next=48;break}return e.next=46,(0,s.oe)((0,s.JU)(a.db,p,t));case 46:e.next=49;break;case 48:console.warn("deleteNews called without id, skipping document delete");case 49:case"end":return e.stop()}}),e,null,[[0,40],[4,26,30,38],[12,18],[31,,33,37]])})))).apply(this,arguments)}}},function(e){e.O(0,[5124,7739,3203,5085,530,9774,2888,179],(function(){return t=65141,e(e.s=t);var t}));var t=e.O();_N_E=t}]);